const IndexShowModal=(n=true,t=true)=>{const i=document.getElementById("indexCreator"),r=document.getElementById("indexModal"),u=document.getElementById("indexProgress");r.style.display=n?"":"none";i&&(i.style.display=n?"none":"");u.style.display=t?"":"none"},ListenerPageMenu=()=>{const n=document.getElementById("indexPageMenu");if(!n)return!1;const i=new mdc.menu.MDCMenu(n),t=document.querySelector("[mtd-data-page]"),r=t.attributes.getNamedItem("mtd-data-page").nodeValue;t.addEventListener("click",()=>{i.open=!0});const u=document.getElementById("indexMenuSize");u.addEventListener("click",n=>{const i=n.target.getAttribute("data-value");document.body.scrollTop=document.documentElement.scrollTop=0;ActionShowModal(!0);var t=new XMLHttpRequest;t.open("POST",`/api/index/${r}/pagesize/${i}`,!0);t.send();t.onreadystatechange=function(){t.readyState==4&&t.status==200&&document.location.reload()}})},FileDownload=n=>{ActionShowModal(!0);var i=document.getElementById(n),r=CreateFormData(i),t=new XMLHttpRequest;t.open("POST",i.action,!0);t.responseType="arraybuffer";t.onload=function(){var n,f,h,e,o,r,s,u,i,c,l;if(this.status===200){if(n="",f=t.getResponseHeader("Content-Disposition"),f&&f.indexOf("attachment")!==-1&&(h=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,e=h.exec(f),e!=null&&e[1]&&(n=e[1].replace(/['"]/g,""))),o=t.getResponseHeader("Content-Type"),typeof File=="function")try{r=new File([this.response],n,{type:o})}catch(a){}typeof r=="undefined"&&(r=new Blob([this.response],{type:o}));typeof window.navigator.msSaveBlob!="undefined"?window.navigator.msSaveBlob(r,n):(s=window.URL||window.webkitURL,u=s.createObjectURL(r),n?(i=document.createElement("a"),typeof i.download=="undefined"?window.location.href=u:(i.href=u,i.download=n,document.body.appendChild(i),i.click())):window.location.href=u,setTimeout(function(){s.revokeObjectURL(u)},100),ActionShowModal())}this.status==400&&(c=(new TextDecoder).decode(this.response),l=JSON.parse(c),setTimeout(()=>{ActionShowModal(),MainShowSnackBar(l.value,!0)},1e3));this.status==500&&setTimeout(()=>{ActionShowModal(),MainShowSnackBar("500 Internal Server Error",!0)},1e3)};t.send(r)};ListenerPageMenu();const storeIds=document.getElementById("nav-store-ids");storeIds&&sessionStorage.setItem("storeIds",storeIds.value);new MTDTextField("search-text");new MTDTextField("search-number");class ServiceForm{constructor(){this.locale=document.getElementById("index-locale-for-date");this.dateStart=new MTDTextField("index-filter-date-start");this.dateFinish=new MTDTextField("index-filter-date-finish");this.number=new MTDTextField("index-filter-related-number");this.period=document.getElementById("index-filter-service-period");this.owners=document.getElementById("index-filter-service-owners");this.related=document.getElementById("index-filter-service-related");this.select=new MTDSelectList("index-filter-service-list");this.ownersList=new MTDSelectList("index-filter-service-owners-list");this.relatedDocs=new MTDSelectList("index-filter-service-related-list")}}class ExctensionForm{constructor(){this.selectScript=new MTDSelectList("index-filter-extension-list");this.scriptId=document.getElementById("index-filter-extension-script")}}class CustomForm{constructor(){this.resultId=document.getElementById("index-filter-custom-result-id");this.resultType=document.getElementById("index-filter-custom-result-type");this.resultAction=document.getElementById("index-filter-custom-result-action");this.resultValue=document.getElementById("index-filter-custom-result-value");this.resultValueExt=document.getElementById("index-filter-custom-result-value-ext");this.selectAction=new MTDSelectList("index-filter-custom-action");this.selectValue=new MTDSelectList("index-filter-custom-list-value");this.selectFields=new MTDSelectList("index-filter-custom-fields");this.textValue=new MTDTextField("index-filter-custom-text-value");this.intValue=new MTDTextField("index-filter-custom-int-value");this.boolValue=new MTDSelectList("index-filter-custom-bool-value");this.dateStartValue=new MTDTextField("index-filter-custom-date-start-value");this.dateFinishValue=new MTDTextField("index-filter-custom-date-finish-value")}}const IndexFilterShowTab=n=>{["custom","service","extension"].forEach(t=>{const i=document.getElementById(`index-filter-${t}`);i.style.display=t===n?"block":"none"})},ShowCustomFieldTypes=n=>{["text","int","date","list","bool","text"].forEach(t=>{const i=document.getElementById(`index-filter-custom-${t}`);i.style.display=t===n?"block":"none"})},Service=()=>{const n=new ServiceForm;n.select.selector.listen("MDCSelect:change",()=>{const t=n.select.selector.value;n.period.style.display=t==="DateCreated"?"":"none";n.owners.style.display=t==="DocumentOwner"?"":"none";n.related&&(n.related.style.display=t==="DocumentBased"?"":"none")});const t=new LocaleDTP;$(n.dateStart.input).datetimepicker({timepicker:!1,lang:t.lang,mask:t.mask,format:t.format,defaultDate:new Date});$(n.dateFinish.input).datetimepicker({timepicker:!1,lang:t.lang,mask:t.mask,format:t.format,defaultDate:new Date})},GetCustomPartForType=n=>{let t;switch(n){case"2":case"3":t="int";break;case"5":case"6":t="date";break;case"11":t="list";break;case"12":t="bool";break;default:t="text"}return t},RequestFieldList=(n,t)=>{const i=document.getElementById("index-filter-custom-list-form"),r=i.querySelector("input[id='id-field']");r.value=n;const u=CreateFormData(i);fetch(i.action,{method:i.method,body:u}).then(n=>n.json()).then(n=>{n.value&&(t.RemoveItems(),n.value.forEach((n,i)=>{selected=!1,i===0&&(selected=!0),t.AddItem(n.id,n.value,selected)}))})},Custom=()=>{const n=new CustomForm;n.resultAction.value=n.selectAction.selector.value;n.resultId.value=n.selectFields.selector.value;n.selectAction.selector.listen("MDCSelect:change",()=>{n.resultAction.value=n.selectAction.selector.value});n.selectValue.selector.listen("MDCSelect:change",()=>{n.resultValue.value=n.selectValue.selector.value});n.boolValue.selector.listen("MDCSelect:change",()=>{n.resultValue.value=n.boolValue.selector.value});n.textValue.input.addEventListener("input",()=>{n.resultValue.value=n.textValue.textField.value});n.intValue.input.addEventListener("input",()=>{n.resultValue.value=n.intValue.textField.value});const t=new LocaleDTP;$(n.dateStartValue.input).datetimepicker({timepicker:!1,locale:t.locale,mask:t.mask,format:t.format,defaultDate:new Date,onSelectDate:function(){n.resultValue.value=n.dateStartValue.textField.value}});$(n.dateFinishValue.input).datetimepicker({timepicker:!1,locale:t.locale,mask:t.mask,format:t.format,defaultDate:new Date,onSelectDate:function(){n.resultValueExt.value=n.dateFinishValue.textField.value}});const i=n.selectFields.div.querySelector(`[data-value='${n.selectFields.selector.value}']`),r=GetCustomPartForType(i);ShowCustomFieldTypes(r);n.selectFields.selector.listen("MDCSelect:change",()=>{const i=n.selectFields.div.querySelector(`[data-value='${n.selectFields.selector.value}']`);if(i){const t=i.getAttribute("data-type"),u=GetCustomPartForType(t);n.resultType.value=t;n.resultId.value=n.selectFields.selector.value;n.textValue.textField.value="";n.intValue.textField.value="";n.boolValue.selector.value="1";n.dateStartValue.textField.value="";n.dateFinishValue.textField.value="";n.resultValue.value="";n.resultValueExt.value="";t==="11"&&RequestFieldList(n.selectFields.selector.value,n.selectValue);n.selectAction.div.classList.remove("mtd-main-display-none");const r=document.getElementById("custom-separ");r.classList.remove("mtd-main-display-none");(t==="12"||t==="11"||t==="5"||t==="6")&&(n.selectAction.div.classList.add("mtd-main-display-none"),r.classList.add("mtd-main-display-none"));t==="12"&&(n.resultValue.value="1");(t==="2"||t==="3")&&(n.resultValue.value="10");ShowCustomFieldTypes(u)}});n.selectFields.selector.emit("MDCSelect:change")},Extension=()=>{const n=new ExctensionForm;n.scriptId.value=n.selectScript.selector.value;n.selectScript.selector.listen("MDCSelect:change",()=>{n.scriptId.value=n.selectScript.selector.value})},tabBar=document.getElementById("index-filter-tabs");new mdc.tabBar.MDCTabBar(tabBar);Service();Custom();Extension();const ListenerFilterColumn=()=>{document.getElementById("indexButtonColApply").addEventListener("click",()=>{var n,r,t;const i=document.getElementById("indexFormColumn");ActionShowModal(!0);const f=document.getElementById("indexListColumn"),e=f.querySelectorAll("li");let u="";e.forEach(n=>{const t=n.getAttribute("aria-checked");if(t==="true"){const t=n.getAttribute("data-value");u+=`${t},`}});document.getElementById("indexDataColumnList").value=u;const o=document.getElementById("show-number"),s=document.getElementById("show-date"),h=document.getElementById("indexDataColumnNumber"),c=document.getElementById("indexDataColumnDate");for(h.value=o.checked,c.value=s.checked,n=new XMLHttpRequest,n.open("POST",i.getAttribute("action"),!0),r=new FormData,t=0;t<i.length;t++)r.append(i[t].name,i[t].value);n.send(r);n.onreadystatechange=function(){n.readyState==4&&n.status==200&&document.location.reload(location.hash,"")}})};ListenerFilterColumn();